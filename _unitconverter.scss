// ____________________________________________________________________________
//
//    Sass Unit Converter v.2.3.3
//    npm install sass-unitconverter
//    Based on https://github.com/jakob-e/unitconversion
// ____________________________________________________________________________
//
//   Function                  Input units
//
//   Absolute length
//   px(input);                px, pt, pc, mm, cm, in, em, rem, number
//   pt(input);                px, pt, pc, mm, cm, in, em, rem, number
//   pc(input);                px, pt, pc, mm, cm, in, em, rem, number
//   mm(input);                px, pt, pc, mm, cm, in, em, rem, number
//   cm(input);                px, pt, pc, mm, cm, in, em, rem, number
//   in(input);                px, pt, pc, mm, cm, in, em, rem, number
//
//   Relative length
//   em(input);                px, pt, pc, mm, cm, in, em, rem, number
//   rem(input);               px, pt, pc, mm, cm, in, em, rem, number
//   ex(input);                ex, number
//   ch(input);                ch, number
//   vw(input);                vw, number
//   vh(input);                vh, number
//   vmin(input);              vmin, number
//   vmax(input);              vmax, number
//
//   Angle
//   deg(input);               deg, rad, grad, turn, number
//   rad(input);               deg, rad, grad, turn, number
//   grad(input);              deg, rad, grad, turn, number
//   turn(input);              deg, rad, grad, turn, number
//
//   Time
//   s(input);                 s, ms, number
//   ms(input);                s, ms, number
//
//   Frequency
//   hz(input);                hz, khz, number
//   khz(input);               hz, khz, number
//
//   Resolution
//   dpi(input);               dpi, dpcm, dppx, number
//   dpcm(input);              dpi, dpcm, dppx, number
//   dppx(input);              dpi, dpcm, dppx, number
//
//   String
//   str(input);               anything not null
//
//   Number, int and uint
//   num(input);               px, pt, pc, mm, cm, in, em, rem, ex, ch,
//                             vw, vh, vmin, vmax, deg, rad, grad, turn,
//                             dpi, dpcm, dppx, s, ms, hz, khz, number, string
//   int(input);               as number
//   uint(input);              as number
//
//   ratio                     number to fraction
//
//   ETC Convert
//   one-unit(input);          px, pt, pc, mm, cm, in, em, rem, ex, ch,
//                             vw, vh, vmin, vmax, deg, rad, grad, turn,
//                             dpi, dpcm, dppx, s, ms, hz, khz, number
//   to-unit(input, unit);     same
//   to-unit-list(list, unit); same as list
//   to-unit-map(map, unit);   same as map
//
//   is-[unit](input)          each unit
//   is-num(input, strict)     strict: true(default) => pure number
//                                     false         => type-is number
//   is-null(input, strict)    strict: true(default) => pure null
//                                     false         => null, length is 0(list, map, string)
//
//   Aliases
//   string(input);
//   number(input);
//   is-percent(input);
//   is-string(input);
//   is-length(input);
//   is-number(input, strict);
//
// ____________________________________________________________________________

// == Base =====================================================================
// Base font size in pixel for converting em and rem to absolute lengths.
$root-font-size: 16px            !default;
$base-font-size: $root-font-size !default;

@function n-units($number) {
  @return (
    // absolute length
    px: $number * 1px, pt: $number * 1pt, pc: $number * 1pc,
    mm: $number * 1mm, cm: $number * 1cm, in: $number * 1in,

    // relative length - font based
    em: $number * 1em, rem: $number * 1rem,
    ch: $number * 1ch,  ex: $number * 1ex,

    // relative length - viewport based
    vw:   $number * 1vw,     vh: $number * 1vh,
    vmin: $number * 1vmin, vmax: $number * 1vmax,

    // angle
    deg:  $number * 1deg,   rad: $number * 1rad,
    grad: $number * 1grad, turn: $number * 1turn,

    // time
    s: $number * 1s, ms: $number * 1ms,

    // frequency
    hz: $number * 1Hz, khz: $number * 1kHz,
    Hz: $number * 1Hz, kHz: $number * 1kHz,

    // resolution
    dppx: $number * 1dppx, dpcm: $number * 1dpcm, dpi: $number * 1dpi,

    // percent or number
    "%": $number * 1%, pct:    $number * 1%, percent: $number * 1%,
    num: $number * 1,  number: $number * 1
  );
}


// == Conversion ===============================================================
// Get unit
@function get-unit($input) {
  $type: type-of($input);
  @if $type == 'number' {
    $unit: unit($input);
    @return if($unit == '', 'num', $unit);
  }
  @return $type;
}

// Get 1size of value
@function one-unit($input) {
  $type: type-of($input);
  @if $type == 'number' {
    @return ($input / num($input));
  }
  @if $type != 'string' {
    @error 'Value for `unit` should be a number or string.';
  }

  $units: n-units(1);
  $parsed-unit: false;

  @each $unit in $units {
    // str-index - find substring in a string
    // 'px' in '10px' for example

    // $unit is a pair of ['px': 1px] (item in $units)
    // nth(['px': 1px], 1) returns 'px'
    // nth(['px': 1px], 2) returns 1px

    @if (str-index($input, nth($unit, 1))) {
      $parsed-unit: nth($unit, 2);
    }
  }

  @if (not $parsed-unit) {
    @error 'Invalid unit `#{$input}` – must be a valid CSS unit';
  }

  @return $parsed-unit;
}

// Get break
@function get-break($unit, $break-width, $break-height) {
  $break-width:  if(is-null($break-width),  null, px($break-width, $break-width,  $break-height));
  $break-height: if(is-null($break-height), null, px($break-height, $break-width, $break-height));

  @if $unit == vw {
    @return $break-width;
  }
  @if $unit == vh {
    @return $break-height;
  }
  @if $unit == vmin {
    @return min($break-width, $break-height);
  }
  @if $unit == vmax {
    @return max($break-width, $break-height);
  }
}

// Conversion function
@function to-unit($input, $unit, $break-width: null, $break-height: null) {
  // Test against valid CSS units
  $units: n-units(0);
  $to-unit: map-get($units, $unit);

  // Error handling – wrong $unit
  // Incomparable units are caught in convertion
  @if not $to-unit {
    @error 'Could not convert to `#{$unit}` – must be a valid CSS unit';
    @return null;
  }

  // Number/incomparable conversion
  @if index(num number ex ch, $unit) {
    $value: num($input);
  }

  // EM convertion using px as base
  @if index(em, unit($input)) {
    $input: 0px + num($input) * $base-font-size/1px;
  }
  @if index(em, $unit) and not unitless($input) {
    $input: 0px + px($input);
    $input: num($input) * 1px/$base-font-size;
  }

  // REM convertion using px as base
  @if index(rem, unit($input)) {
    $input: 0px + num($input) * $root-font-size/1px;
  }
  @if index(rem, $unit) and not unitless($input) {
    $input: 0px + $input;
    $input: num($input) * 1px/$root-font-size;
  }

  // Bug fix – resolution units seems to be flipped
  @if index(dpi dpcm dppx, $unit){
    $units: (dppx: 0dppx, dpcm: 0dpcm, dpi: 0dpi);
    $input-unit: map-get($units, unit($input));
    $input: if(1dppx < 95dpi,num($input-unit + (num($input) + $to-unit)),$input);
  }

  // $input is VW, VH, VMIN, VMAX
  @if index(vw vh vmin vmax, unit($input)) {
    $break: get-break(unit($input), $break-width, $break-height);
    $input: ($break * num($input)) / 100;
  }

  // $unit is VW, VH, VMIN, VNAX
  @if index(vw vh vmin max, $unit) and not index(num number, unit($input)) {
    $break: num(get-break($unit, $break-width, $break-height));
    $input: num(px($input, $break-width, $break-height));
    $input: ($input / $break) * 100;
  }

  // Convert
  @return $to-unit + $input;
}

// Convesion List
@function to-unit-list($list, $unit, $break-width: null, $break-height: null) {
  $new-list: ();

  @each $value in $list {
    $converted: to-unit($value, $unit, $break-width, $break-height);
    $new-list: append($new-list, $converted);
  }
  @return $new-list;
}

// Conversion Map
@function to-unit-map($map, $unit, $break-width: null, $break-height: null) {
  $new-map: ();

  @each $key, $value in $map {
    $converted: to-unit($value, $unit, $break-width, $break-height);
    $new-map: map-merge($new-map, ($key: $converted));
  }
  @return $new-map;
}

// Trampoline Function
@function to-unit-converted($value, $unit) {
  @return if(is-num($value, false),
             to-unit($value, $unit), to-unit-data($value, $unit));
}

// Conversion most of the data.
@function to-unit-data($data, $unit) {
  $new-data: ();
  @if      is-list($data) {
    @each $value in $data {
      $converted: to-unit-converted($value, $unit);
      $new-data: append($new-data, $converted);
    }
  }
  @else if is-map($data) {
    @each $key, $value in $data {
      $converted: to-unit-converted($value, $unit);
      $new-data: map-merge($new-data, ($key: $converted));
    }
  }
  @else {
    @return if(is-num($data, false), to-unit($data, $unit), $data);
  }
  @return $new-data;
}

//  Convert number to ratio (fraction)
//  ratio(1.7777778) =>   16/9
@function ratio($x, $y: null){
  @if not $y {
    $n: $x; $y: 1;
    @while $y < 10 {
      $x:  $n * 10 - ((10 - $y) * $n);
      @if $x == round($x){ @return #{$x}/#{$y}; }
      @else { $y: $y + 1; }
    }
    $x: round($n * 1000000); $y: 1000000;
    @while $x % 10 == 0 { $x: $x/10; $y: $y/10; }
    @while $x % 5 == 0 { $x: $x/5; $y: $y/5; }
    @while $x % 2 == 0 { $x: $x/2; $y: $y/2; }
    @return #{$x}/#{$y};
  }
  @else if $x == round($x) and $y == round($y){ @return #{$x}/#{$y}; }
  @warn 'X and Y must be integers'; @return false;
}


// == Interface - Convert ======================================================
// Absolute lengths
@function px($input, $break-width: null, $break-height: null) { @return to-unit($input, px, $break-width, $break-height); }
@function pt($input, $break-width: null, $break-height: null) { @return to-unit($input, pt, $break-width, $break-height); }
@function pc($input, $break-width: null, $break-height: null) { @return to-unit($input, pc, $break-width, $break-height); }
@function mm($input, $break-width: null, $break-height: null) { @return to-unit($input, mm, $break-width, $break-height); }
@function cm($input, $break-width: null, $break-height: null) { @return to-unit($input, cm, $break-width, $break-height); }
@function in($input, $break-width: null, $break-height: null) { @return to-unit($input, in, $break-width, $break-height); }

// Relative lengths
@function em($input, $break-width: null, $break-height: null) {
  $em: to-unit(nth($input, 1), em, $break-width, $break-height);
  // Adjust for compounds (visual size)
  @if length($input) > 1 {
    @for $i from 2 through length($input) {
      $em: $em / num(em(nth($input, $i), $break-width, $break-height));
    }
  }
  @return $em;
}
@function rem($input, $break-width: null, $break-height: null) { @return to-unit($input, rem, $break-width, $break-height); }

// Inconvertible relative lengths – depends on font
@function ex($input, $break-width: null, $break-height: null) { @return to-unit($input, ex, $break-width, $break-height); }
@function ch($input, $break-width: null, $break-height: null) { @return to-unit($input, ch, $break-width, $break-height); }

// Relative lengths - Viewport
@function   vw($input, $break-width: null, $break-height: null) { @return to-unit($input,   vw, $break-width, $break-height); }
@function   vh($input, $break-width: null, $break-height: null) { @return to-unit($input,   vh, $break-width, $break-height); }
@function vmin($input, $break-width: null, $break-height: null) { @return to-unit($input, vmin, $break-width, $break-height); }
@function vmax($input, $break-width: null, $break-height: null) { @return to-unit($input, vmax, $break-width, $break-height); }

// Angles
@function  deg($input, $break-width: null, $break-height: null) { @return to-unit($input,  deg, $break-width, $break-height); }
@function  rad($input, $break-width: null, $break-height: null) { @return to-unit($input,  rad, $break-width, $break-height); }
@function grad($input, $break-width: null, $break-height: null) { @return to-unit($input, grad, $break-width, $break-height); }
@function turn($input, $break-width: null, $break-height: null) { @return to-unit($input, turn, $break-width, $break-height); }

// Time
@function ms($input, $break-width: null, $break-height: null) { @return to-unit($input, ms, $break-width, $break-height); }
@function  s($input, $break-width: null, $break-height: null) { @return to-unit($input,  s, $break-width, $break-height); }

// Frequencies
@function  hz($input, $break-width: null, $break-height: null) { @return to-unit($input,  hz, $break-width, $break-height); }
@function khz($input, $break-width: null, $break-height: null) { @return to-unit($input, khz, $break-width, $break-height); }

// Resolution
@function  dpi($input, $break-width: null, $break-height: null) { @return to-unit($input,  dpi, $break-width, $break-height); }
@function dpcm($input, $break-width: null, $break-height: null) { @return to-unit($input, dpcm, $break-width, $break-height); }
@function dppx($input, $break-width: null, $break-height: null) { @return to-unit($input, dppx, $break-width, $break-height); }

// Strings and numbers
// https://css-tricks.com/snippets/sass/strip-unit-function/
// https://stackoverflow.com/questions/47630616/scss-arithmetic-operation-with-string
@function str($input) { @return #{$input};  }
@function num($input) {
  @if is-num($input) { @return $input; }
  @if type-of($input) == 'number' and not unitless($input) {
    @return $input / ($input * 0 + 1);
  } @else if type-of($input) != 'string' {
    @error 'Could not convert `#{$input}` - must be `type-of number or a string.`';
    @return null;
  }

  $result: 0;
  $digits: 0;
  $minus: str-slice($input, 1, 1) == '-';
  $numbers: ('0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9);

  @for $i from if($minus, 2, 1) through str-length($input) {
    $character: str-slice($input, $i, $i);

    @if (index(map-keys($numbers), $character) or $character == '.') {
      @if $character == '.' {
        $digits: 1;
      } @else if $digits == 0 {
        $result: $result * 10 + map-get($numbers, $character);
      } @else {
        $digits: $digits * 10;
        $result: $result + map-get($numbers, $character) / $digits;
      }
    }
  }

  @return if($minus, -$result, $result);;
}
@function int($input) {
  $num: num($input);
  @return if($num<0, ceil($num), floor($num));
}
@function uint($input) { @return abs(int($input)); }

// Aliases
@function string($input) { @return str($input); }
@function number($input) { @return num($input); }


// == Interface - Check ========================================================
// Absolute lengths
@function is-px($input) { @return get-unit($input) == 'px'; }
@function is-pt($input) { @return get-unit($input) == 'pt'; }
@function is-pc($input) { @return get-unit($input) == 'pc'; }
@function is-mm($input) { @return get-unit($input) == 'mm'; }
@function is-cm($input) { @return get-unit($input) == 'cm'; }
@function is-in($input) { @return get-unit($input) == 'in'; }

// Relative lengths - font based
@function  is-em($input) { @return get-unit($input) ==  'em'; }
@function is-rem($input) { @return get-unit($input) == 'rem'; }
@function  is-ex($input) { @return get-unit($input) ==  'ex'; }
@function  is-ch($input) { @return get-unit($input) ==  'ch'; }

// Relative lengths - viewport based
@function   is-vw($input) { @return get-unit($input) ==   'vw'; }
@function   is-vh($input) { @return get-unit($input) ==   'vh'; }
@function is-vmin($input) { @return get-unit($input) == 'vmin'; }
@function is-vmax($input) { @return get-unit($input) == 'vmax'; }

// Angles
@function  is-deg($input) { @return get-unit($input) ==  'deg'; }
@function  is-rad($input) { @return get-unit($input) ==  'rad'; }
@function is-grad($input) { @return get-unit($input) == 'grad'; }
@function is-turn($input) { @return get-unit($input) == 'turn'; }

// Time
@function is-ms($input) { @return get-unit($input) == 'ms'; }
@function  is-s($input) { @return get-unit($input) ==  's'; }

// Frequencies
@function  is-hz($input) { @return get-unit($input) ==  'hz'; }
@function is-khz($input) { @return get-unit($input) == 'khz'; }

// Resolution
@function  is-dpi($input) { @return get-unit($input) ==  'dpi'; }
@function is-dpcm($input) { @return get-unit($input) == 'dpcm'; }
@function is-dppx($input) { @return get-unit($input) == 'dppx'; }

// Percent, Number, Length, String
@function  is-pct($input) { @return get-unit($input) ==      '%'; }
@function  is-num($input, $strict: true) {
  @return if($strict, get-unit($input) == 'num', type-of($input) == 'number');
}
@function  is-len($input) {
  @return is-num($input) != is-num($input, false);
}
@function  is-str($input) { @return get-unit($input) == 'string'; }

// ETC: SASS Types
@function  is-null($input, $strict: true) {
  $null-check: get-unit($input) == 'null';
  @return if($strict, $null-check, $null-check or length($input) == 0 or $input == '');
}
@function  is-bool($input) { @return get-unit($input) ==  'bool'; }
@function  is-list($input) { @return get-unit($input) ==  'list'; }
@function   is-map($input) { @return get-unit($input) ==   'map'; }
@function is-color($input) { @return get-unit($input) == 'color'; }

@function is-equal($inputA, $inputB) { @return $inputA == $inputB; }
@function is-exist($input, $strict: true) {
  $variable-exists: variable-exists($input);
  @return if($strict, $variable-exists, $variable-exists and $input);
}
@function is-calc($input) {
  @if not is-str($input) {
    @return false;
  }
  @else {
    $str-front:  str-slice($input, 1, 5) == "calc(";
    $str-back:   str-slice($input, str-length($input)) == ")";
    @return $str-front and $str-back;
  }
}

// Aliases
@function is-percent($input) { @return is-pct($input); }
@function  is-number($input, $strict: true) { @return is-num($input, $strict); }
@function  is-length($input) { @return is-len($input); }
@function  is-string($input) { @return is-str($input); }
